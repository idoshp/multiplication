<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×œ×•×— ×”×›×¤×œ - ×ª×¨×’×•×œ ×›×™×ª×” ×’'</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 30px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 500px;
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        h1 {
            color: #667eea;
            font-size: 2.5em;
            margin-bottom: 30px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .exercise-box {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            border-radius: 20px;
            padding: 30px;
            margin: 30px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .exercise {
            font-size: 3em;
            color: white;
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin: 20px 0;
            direction: ltr;
            text-align: left;
        }

        .input-group {
            margin: 30px 0;
        }

        input[type="number"] {
            font-size: 2em;
            padding: 15px 25px;
            border: 4px solid #667eea;
            border-radius: 15px;
            text-align: center;
            width: 250px;
            min-width: 250px;
            outline: none;
            transition: all 0.3s;
            -moz-appearance: textfield;
            appearance: textfield;
        }

        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }

        input[type="number"]:focus {
            border-color: #f5576c;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.5);
            transform: scale(1.05);
        }

        .button-group {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        button {
            font-size: 1.5em;
            padding: 15px 40px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .check-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .check-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }

        .check-btn:active {
            transform: translateY(0);
        }

        .next-btn {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .next-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(245, 87, 108, 0.4);
        }

        .feedback {
            margin-top: 20px;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.3em;
            font-weight: bold;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
        }

        .feedback.correct {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: #2d5016;
            animation: bounce 0.5s;
        }

        .feedback.wrong {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #8b4513;
            animation: shake 0.5s;
        }

        .explanation {
            margin-top: 15px;
            font-size: 1.1em;
            color: #8b4513;
            font-weight: normal;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-20px); }
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        .fireworks {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1000;
        }

        .firework {
            position: absolute;
            width: 4px;
            height: 4px;
            border-radius: 50%;
            animation: explode 1s ease-out forwards;
        }

        @keyframes explode {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            100% {
                transform: scale(20);
                opacity: 0;
            }
        }

        .emoji {
            font-size: 2em;
            margin: 0 10px;
        }

        .hidden {
            display: none;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
            font-size: 1.2em;
            color: #667eea;
            font-weight: bold;
        }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 20px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
            border-radius: 10px;
        }

        .results-screen {
            padding: 20px;
        }

        .results-title {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 30px;
        }

        .stat-box {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            font-size: 1.3em;
            color: #2d5016;
        }

        .stat-label {
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5em;
        }

        .wrong-exercises {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
            color: #8b4513;
        }

        .wrong-exercises-title {
            font-weight: bold;
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        .wrong-exercise-item {
            margin: 5px 0;
            font-size: 1.1em;
        }

        .selection-screen {
            padding: 20px;
        }

        .selection-title {
            font-size: 2em;
            color: #667eea;
            margin-bottom: 40px;
        }

        .range-button {
            font-size: 1.8em;
            padding: 25px 50px;
            margin: 20px 0;
            width: 100%;
            max-width: 400px;
            border: none;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.2);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .range-button:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .range-button:active {
            transform: translateY(-2px);
        }

        .range-button.easy {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
            color: #2d5016;
        }

        .range-button.medium {
            background: linear-gradient(135deg, #ffe66d 0%, #ffa726 100%);
            color: #8b4513;
        }

        .range-button.hard {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .school-info {
            font-size: 1.3em;
            color: #667eea;
            margin-bottom: 30px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>×œ×•×— ×”×›×¤×œ - ×—×™×“×•×Ÿ</h1>
        
        <div id="selectionScreen">
            <div class="selection-screen">
                <div class="school-info">×‘×™×ª ×¡×¤×¨ ×ª×œ×´×™ ×¨×¢× × ×” ×›×™×ª×” ×’</div>
                <h2 class="selection-title">×‘×—×¨ ×˜×•×•×— ×›×¤×•×œ×•×ª:</h2>
                <div style="display: flex; flex-direction: column; align-items: center; gap: 15px;">
                    <button class="range-button easy" data-range="1-5">
                        ×›×¤×•×œ×•×ª 1-5
                    </button>
                    <button class="range-button medium" data-range="5-9">
                        ×›×¤×•×œ×•×ª 5-9
                    </button>
                    <button class="range-button hard" data-range="1-100">
                        ×›×¤×•×œ×•×ª 1-100
                    </button>
                </div>
            </div>
        </div>
        
        <div id="quizScreen" class="hidden">
            <div class="progress-info">
                <span id="questionCounter">×©××œ×” 1 ××ª×•×š 20</span>
                <span id="timer">00:00</span>
            </div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill" style="width: 5%"></div>
            </div>
            
            <div class="exercise-box">
                <div class="exercise" id="exercise">5 Ã— 3 = ?</div>
            </div>

            <div class="input-group">
                <input type="number" id="answer" placeholder="×”×§×œ×“ ×ª×©×•×‘×”" autocomplete="off">
            </div>

            <div class="button-group">
                <button class="check-btn" id="checkBtn">âœ“ ×‘×“×•×§</button>
                <button class="next-btn hidden" id="nextBtn">â¡ï¸ ×©××œ×” ×”×‘××”</button>
            </div>

            <div class="feedback hidden" id="feedback"></div>
        </div>

        <div id="resultsScreen" class="hidden">
            <div class="results-screen">
                <h2 class="results-title">ğŸ‰ ×¡×™×™××ª ××ª ×”×—×™×“×•×Ÿ! ğŸ‰</h2>
                
                <div class="stat-box">
                    <div class="stat-label">×ª×©×•×‘×•×ª × ×›×•× ×•×ª:</div>
                    <div class="stat-value" id="correctCount">0 / 20</div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">×–××Ÿ:</div>
                    <div class="stat-value" id="timeTaken">00:00</div>
                </div>

                <div class="stat-box">
                    <div class="stat-label">××—×•×– ×”×¦×œ×—×”:</div>
                    <div class="stat-value" id="successRate">0%</div>
                </div>

                <div id="wrongExercisesBox" class="wrong-exercises hidden">
                    <div class="wrong-exercises-title">ğŸ“ ×›×¤×•×œ×•×ª ×œ×ª×¨×’×•×œ × ×•×¡×£:</div>
                    <div id="wrongExercisesList"></div>
                </div>

                <div style="display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; margin-top: 30px;">
                    <button class="next-btn" id="newQuizBtn" style="font-size: 1.5em; padding: 20px 50px;">
                        ğŸ¯ ×—×™×“×•×Ÿ ×—×“×©
                    </button>
                    <button class="check-btn" id="backToSelectionBtn" style="font-size: 1.5em; padding: 20px 50px;">
                        ğŸ  ×—×–×¨×” ×œ××¡×š ×”×¨××©×™
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="fireworks" id="fireworks"></div>

    <script>
        // ××¦×‘ ×”×—×™×“×•×Ÿ
        let quizState = {
            currentQuestion: 0,
            totalQuestions: 20,
            correctAnswers: 0,
            wrongExercises: new Set(), // ×©××™×¨×ª ×›×¤×•×œ×•×ª ×©×’×•×™×•×ª
            startTime: null,
            exercises: [], // ×¨×©×™××ª ×›×œ ×”×ª×¨×’×™×œ×™× ×‘×—×™×“×•×Ÿ
            askedExercises: new Set(), // ×ª×¨×’×™×œ×™× ×©×›×‘×¨ × ×©××œ×• ×‘×—×™×“×•×Ÿ ×”× ×•×›×—×™
            currentExercise: { num1: 0, num2: 0, answer: 0 },
            isAnswered: false,
            timerInterval: null,
            exercisePool: [], // ×××’×¨ ×ª×¨×’×™×œ×™× ×œ×—×™×“×•×Ÿ
            range: { min: 1, max: 5 } // ×˜×•×•×— ×›×¤×•×œ×•×ª ×‘×¨×™×¨×ª ××—×“×œ
        };

        // ×›×¤×•×œ×•×ª ×©×”×ª×œ××™×“ ×˜×¢×” ×‘×”×Ÿ (×œ×©×™××•×© ×‘×—×™×“×•×Ÿ ×”×‘×)
        let weakMultiplications = new Set();

        // ×™×¦×™×¨×ª ×××’×¨ ×ª×¨×’×™×œ×™× ×œ×—×™×“×•×Ÿ
        function createExercisePool() {
            const pool = [];
            const usedKeys = new Set();
            const { min, max } = quizState.range;
            
            // ×™×¦×™×¨×ª ×›×œ ×”×ª×¨×’×™×œ×™× ×”××¤×©×¨×™×™× ×œ×¤×™ ×”×˜×•×•×— ×©× ×‘×—×¨
            for (let num1 = min; num1 <= max; num1++) {
                for (let num2 = min; num2 <= max; num2++) {
                    const key = `${num1}Ã—${num2}`;
                    if (!usedKeys.has(key)) {
                        pool.push({ num1, num2, key });
                        usedKeys.add(key);
                    }
                }
            }
            
            // ×× ×™×© ×›×¤×•×œ×•×ª ×©×”×ª×œ××™×“ ×˜×¢×” ×‘×”×Ÿ, × ×•×¡×™×£ ××•×ª×Ÿ ×™×•×ª×¨ ×¤×¢××™× ×œ×××’×¨
            if (weakMultiplications.size > 0) {
                weakMultiplications.forEach(weakKey => {
                    const [n1, n2] = weakKey.split('Ã—').map(n => parseInt(n));
                    // × ×•×¡×™×£ ×›×œ ×›×¤×•×œ×” ×©×’×•×™×” ×¢×•×“ 3 ×¤×¢××™× ×œ×××’×¨
                    for (let i = 0; i < 3; i++) {
                        pool.push({ num1: n1, num2: n2, key: weakKey });
                    }
                });
            }
            
            // ×¢×¨×‘×•×‘ ×”×××’×¨
            for (let i = pool.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [pool[i], pool[j]] = [pool[j], pool[i]];
            }
            
            return pool;
        }

        // ×™×¦×™×¨×ª ×ª×¨×’×™×œ - ×¢× ×”×¢×“×¤×” ×œ×›×¤×•×œ×•×ª ×©×’×•×™×•×ª, ××‘×œ ×œ×œ× ×—×–×¨×”
        function generateExercise() {
            let num1, num2, exerciseKey;
            let attempts = 0;
            const maxAttempts = 100;
            
            // ×× ×”×××’×¨ × ×’××¨ ××• ×›××¢×˜ × ×’××¨, × ×™×¦×•×¨ ×××’×¨ ×—×“×©
            if (quizState.exercisePool.length === 0 || 
                quizState.exercisePool.length < (quizState.totalQuestions - quizState.currentQuestion)) {
                quizState.exercisePool = createExercisePool();
            }
            
            // × ×‘×—×¨ ×ª×¨×’×™×œ ××”×××’×¨ ×©×œ× × ×©××œ ×›×‘×¨
            do {
                if (quizState.exercisePool.length > 0) {
                    const randomIndex = Math.floor(Math.random() * quizState.exercisePool.length);
                    const exercise = quizState.exercisePool[randomIndex];
                    num1 = exercise.num1;
                    num2 = exercise.num2;
                    exerciseKey = exercise.key;
                    quizState.exercisePool.splice(randomIndex, 1); // × ×¡×™×¨ ××”×××’×¨
                } else {
                    // ×× ×”×××’×¨ × ×’××¨, × ×™×¦×•×¨ ×ª×¨×’×™×œ ×¨× ×“×•××œ×™
                    num1 = Math.floor(Math.random() * 5) + 1;
                    num2 = Math.floor(Math.random() * 5) + 1;
                    exerciseKey = `${num1}Ã—${num2}`;
                }
                attempts++;
            } while (quizState.askedExercises.has(exerciseKey) && attempts < maxAttempts);
            
            // ×× ×¢×“×™×™×Ÿ ×œ× ××¦×× ×•, × ×‘×—×¨ ×ª×¨×’×™×œ ×¨× ×“×•××œ×™ ×©×œ× × ×©××œ
            if (quizState.askedExercises.has(exerciseKey)) {
                // × × ×¡×” ×œ××¦×•× ×ª×¨×’×™×œ ×©×œ× × ×©××œ
                let found = false;
                const { min, max } = quizState.range;
                for (let n1 = min; n1 <= max && !found; n1++) {
                    for (let n2 = min; n2 <= max && !found; n2++) {
                        const key = `${n1}Ã—${n2}`;
                        if (!quizState.askedExercises.has(key)) {
                            num1 = n1;
                            num2 = n2;
                            exerciseKey = key;
                            found = true;
                        }
                    }
                }
                // ×× ×›×œ ×”×ª×¨×’×™×œ×™× × ×©××œ×•, × ×‘×—×¨ ×¨× ×“×•××œ×™
                if (!found) {
                    num1 = Math.floor(Math.random() * (max - min + 1)) + min;
                    num2 = Math.floor(Math.random() * (max - min + 1)) + min;
                    exerciseKey = `${num1}Ã—${num2}`;
                }
            }
            
            // × ×¡××Ÿ ×©×”×ª×¨×’×™×œ × ×©××œ
            quizState.askedExercises.add(exerciseKey);
            
            quizState.currentExercise = {
                num1: num1,
                num2: num2,
                answer: num1 * num2
            };
            
            document.getElementById('exercise').textContent = `${num1} Ã— ${num2} = ?`;
            document.getElementById('answer').value = '';
            document.getElementById('answer').focus();
            document.getElementById('feedback').classList.add('hidden');
            document.getElementById('checkBtn').classList.remove('hidden');
            document.getElementById('nextBtn').classList.add('hidden');
            quizState.isAnswered = false;
        }

        // ×—×–×¨×” ×œ××¡×š ×‘×—×™×¨×”
        function showSelectionScreen() {
            // ×¢×¦×™×¨×ª ×˜×™×™××¨ ×× ×§×™×™×
            if (quizState.timerInterval) {
                clearInterval(quizState.timerInterval);
            }
            
            // ××™×¤×•×¡ ××¦×‘ ×”×—×™×“×•×Ÿ
            quizState.currentQuestion = 0;
            quizState.correctAnswers = 0;
            quizState.wrongExercises.clear();
            quizState.exercises = [];
            quizState.askedExercises.clear();
            quizState.exercisePool = [];
            quizState.isAnswered = false;
            
            // ×”×¡×ª×¨×ª ×›×œ ×”××¡×›×™× ×•×”×¦×’×ª ××¡×š ×‘×—×™×¨×”
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('selectionScreen').classList.remove('hidden');
        }

        // ×”×ª×—×œ×ª ×—×™×“×•×Ÿ ×—×“×©
        function startNewQuiz() {
            quizState.currentQuestion = 0;
            quizState.correctAnswers = 0;
            quizState.wrongExercises.clear();
            quizState.exercises = [];
            quizState.askedExercises.clear(); // ××™×¤×•×¡ ×ª×¨×’×™×œ×™× ×©× ×©××œ×•
            quizState.exercisePool = []; // ××™×¤×•×¡ ×××’×¨ ×”×ª×¨×’×™×œ×™×
            quizState.startTime = Date.now();
            quizState.isAnswered = false;
            
            // ×”×¡×ª×¨×ª ××¡×š ×ª×•×¦××•×ª ×•××¡×š ×‘×—×™×¨×” ×•×”×¦×’×ª ××¡×š ×—×™×“×•×Ÿ
            document.getElementById('resultsScreen').classList.add('hidden');
            document.getElementById('selectionScreen').classList.add('hidden');
            document.getElementById('quizScreen').classList.remove('hidden');
            
            // ×”×ª×—×œ×ª ×˜×™×™××¨
            startTimer();
            
            // ×™×¦×™×¨×ª ×”×ª×¨×’×™×œ ×”×¨××©×•×Ÿ
            generateExercise();
            updateProgress();
        }

        // ×¢×“×›×•×Ÿ ×”×ª×§×“××•×ª
        function updateProgress() {
            const progress = ((quizState.currentQuestion) / quizState.totalQuestions) * 100;
            document.getElementById('progressFill').style.width = progress + '%';
            document.getElementById('questionCounter').textContent = 
                `×©××œ×” ${quizState.currentQuestion + 1} ××ª×•×š ${quizState.totalQuestions}`;
        }

        // ×”×ª×—×œ×ª ×˜×™×™××¨
        function startTimer() {
            if (quizState.timerInterval) {
                clearInterval(quizState.timerInterval);
            }
            
            quizState.timerInterval = setInterval(() => {
                if (quizState.startTime) {
                    const elapsed = Math.floor((Date.now() - quizState.startTime) / 1000);
                    const minutes = Math.floor(elapsed / 60);
                    const seconds = elapsed % 60;
                    document.getElementById('timer').textContent = 
                        `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                }
            }, 1000);
        }

        // ×‘×“×™×§×ª ×ª×©×•×‘×”
        function checkAnswer() {
            if (quizState.isAnswered) return;
            
            const userAnswer = parseInt(document.getElementById('answer').value);
            const feedback = document.getElementById('feedback');
            const checkBtn = document.getElementById('checkBtn');
            const nextBtn = document.getElementById('nextBtn');

            if (isNaN(userAnswer)) {
                alert('×× × ×”×›× ×¡ ××¡×¤×¨!');
                return;
            }

            quizState.isAnswered = true;
            checkBtn.classList.add('hidden');
            nextBtn.classList.remove('hidden');
            feedback.classList.remove('hidden');

            const isCorrect = userAnswer === quizState.currentExercise.answer;
            
            // ×©××™×¨×ª ×”×ª×¨×’×™×œ
            quizState.exercises.push({
                ...quizState.currentExercise,
                userAnswer: userAnswer,
                isCorrect: isCorrect
            });

            if (isCorrect) {
                quizState.correctAnswers++;
                feedback.className = 'feedback correct';
                feedback.innerHTML = '<span class="emoji">ğŸ‰</span> ×›×œ ×”×›×‘×•×“! ×ª×©×•×‘×” × ×›×•× ×”! <span class="emoji">ğŸ‰</span>';
                createFireworks();
            } else {
                // ×©××™×¨×ª ×”×›×¤×•×œ×” ×”×©×’×•×™×”
                const exerciseKey = `${quizState.currentExercise.num1}Ã—${quizState.currentExercise.num2}`;
                quizState.wrongExercises.add(exerciseKey);
                weakMultiplications.add(exerciseKey);
                
                feedback.className = 'feedback wrong';
                const explanation = generateExplanation(
                    quizState.currentExercise.num1, 
                    quizState.currentExercise.num2, 
                    quizState.currentExercise.answer
                );
                feedback.innerHTML = `
                    <div>
                        <span class="emoji">ğŸ¤”</span> ×œ× × ×›×•×Ÿ, ××‘×œ ×œ× × ×•×¨×! <span class="emoji">ğŸ’ª</span>
                        <div class="explanation">${explanation}</div>
                    </div>
                `;
            }
        }

        // ××¢×‘×¨ ×œ×©××œ×” ×”×‘××”
        function nextQuestion() {
            quizState.currentQuestion++;
            
            if (quizState.currentQuestion >= quizState.totalQuestions) {
                // ×¡×™×•× ×”×—×™×“×•×Ÿ
                endQuiz();
            } else {
                // ×©××œ×” ×”×‘××”
                generateExercise();
                updateProgress();
            }
        }

        // ×¡×™×•× ×”×—×™×“×•×Ÿ ×•×”×¦×’×ª ×ª×•×¦××•×ª
        function endQuiz() {
            // ×¢×¦×™×¨×ª ×˜×™×™××¨
            if (quizState.timerInterval) {
                clearInterval(quizState.timerInterval);
            }
            
            // ×”×¡×ª×¨×ª ××¡×š ×—×™×“×•×Ÿ ×•×”×¦×’×ª ××¡×š ×ª×•×¦××•×ª
            document.getElementById('quizScreen').classList.add('hidden');
            document.getElementById('resultsScreen').classList.remove('hidden');
            
            // ×—×™×©×•×‘ ×–××Ÿ
            const elapsed = Math.floor((Date.now() - quizState.startTime) / 1000);
            const minutes = Math.floor(elapsed / 60);
            const seconds = elapsed % 60;
            const timeString = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            
            // ×”×¦×’×ª ×ª×•×¦××•×ª
            document.getElementById('correctCount').textContent = 
                `${quizState.correctAnswers} / ${quizState.totalQuestions}`;
            document.getElementById('timeTaken').textContent = timeString;
            
            const successRate = Math.round((quizState.correctAnswers / quizState.totalQuestions) * 100);
            document.getElementById('successRate').textContent = `${successRate}%`;
            
            // ×”×¦×’×ª ×›×¤×•×œ×•×ª ×©×’×•×™×•×ª
            if (quizState.wrongExercises.size > 0) {
                const wrongBox = document.getElementById('wrongExercisesBox');
                const wrongList = document.getElementById('wrongExercisesList');
                wrongBox.classList.remove('hidden');
                
                let html = '';
                quizState.wrongExercises.forEach(ex => {
                    const [num1, num2] = ex.split('Ã—');
                    html += `<div class="wrong-exercise-item">${num1} Ã— ${num2}</div>`;
                });
                wrongList.innerHTML = html;
            } else {
                document.getElementById('wrongExercisesBox').classList.add('hidden');
            }
        }

        // ×™×¦×™×¨×ª ×”×¡×‘×¨ (×—×™×‘×•×¨ ×—×•×–×¨)
        function generateExplanation(num1, num2, correctAnswer) {
            const additions = [];
            for (let i = 0; i < num2; i++) {
                additions.push(num1);
            }
            const additionString = additions.join(' + ');
            return `${num1} Ã— ${num2} = ${additionString} = ${correctAnswer}`;
        }

        // ×™×¦×™×¨×ª ×–×™×§×•×§×™×
        function createFireworks() {
            const fireworksContainer = document.getElementById('fireworks');
            const colors = ['#ff6b6b', '#4ecdc4', '#ffe66d', '#a8e6cf', '#ff8b94', '#95e1d3'];
            
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const firework = document.createElement('div');
                    firework.className = 'firework';
                    firework.style.left = Math.random() * 100 + '%';
                    firework.style.top = Math.random() * 100 + '%';
                    firework.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    firework.style.boxShadow = `0 0 20px ${firework.style.backgroundColor}`;
                    
                    fireworksContainer.appendChild(firework);
                    
                    setTimeout(() => {
                        firework.remove();
                    }, 1000);
                }, i * 30);
            }
        }

        // ×‘×—×™×¨×ª ×˜×•×•×— ×›×¤×•×œ×•×ª ×•×”×ª×—×œ×ª ×—×™×“×•×Ÿ
        function selectRange(rangeString) {
            let min, max;
            
            switch(rangeString) {
                case '1-5':
                    min = 1;
                    max = 5;
                    break;
                case '5-9':
                    min = 5;
                    max = 9;
                    break;
                case '1-100':
                    min = 1;
                    max = 100;
                    break;
                default:
                    min = 1;
                    max = 5;
            }
            
            quizState.range = { min, max };
            startNewQuiz();
        }

        // ××™×¨×•×¢×™×
        document.getElementById('checkBtn').addEventListener('click', checkAnswer);
        document.getElementById('nextBtn').addEventListener('click', nextQuestion);
        document.getElementById('newQuizBtn').addEventListener('click', startNewQuiz);
        document.getElementById('backToSelectionBtn').addEventListener('click', showSelectionScreen);
        
        // ××™×¨×•×¢×™× ×œ×›×¤×ª×•×¨×™ ×‘×—×™×¨×ª ×˜×•×•×—
        document.querySelectorAll('.range-button').forEach(button => {
            button.addEventListener('click', function() {
                const range = this.getAttribute('data-range');
                selectRange(range);
            });
        });
        
        document.getElementById('answer').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                if (!quizState.isAnswered) {
                    checkAnswer();
                } else {
                    nextQuestion();
                }
            }
        });

        // ×”×ª×—×œ×” ×¢× ××¡×š ×‘×—×™×¨×”
        showSelectionScreen();
    </script>
</body>
</html>
